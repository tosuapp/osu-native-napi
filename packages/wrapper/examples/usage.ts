import {
  Beatmap,
  DifficultyCalculatorFactory,
  Mod,
  ModsCollection,
  OsuDifficultyCalculator,
  OsuPerformanceCalculator,
  PerformanceCalculatorFactory,
  Ruleset,
} from "../osu-native";
import { ScoreInfoInput } from "../osu-native";

const beatmap = Beatmap.fromText(`
osu file format v14

[General]
AudioFilename: audio.mp3
AudioLeadIn: 0
PreviewTime: 25479
Countdown: 0
SampleSet: Soft
StackLeniency: 0.7
Mode: 0
LetterboxInBreaks: 0
WidescreenStoryboard: 0

[Editor]
Bookmarks: 8181,17373,25543,33713,41884
DistanceSpacing: 1
BeatDivisor: 4
GridSize: 32
TimelineZoom: 1.9

[Metadata]
Title:clarity rmx (hayakou bootleg) (cut ver.)
TitleUnicode:clarity rmx (hayakou bootleg) (cut ver.)
Artist:lumious2
ArtistUnicode:lumious2
Creator:azumiw
Version:chasing relentlessly
Source:
Tags:zaslavskiy speedcore jcore english rock electronic Антон Заславский anton zaslavski zaslavsky matthew koma porter robinson skylar grey holly brook hafermann interscope records ft. featuring short version remix foxes feat. zedd xcx maot sharpay shykes askapenas kauan sprixx youru outright quantumvortex osuplayer111 andrea hayakou -_ex_- ex shiyun kowari
BeatmapID:5345468
BeatmapSetID:2448427

[Difficulty]
HPDrainRate:4
CircleSize:3.6
OverallDifficulty:9.8
ApproachRate:10
SliderMultiplier:2.02
SliderTickRate:0.5

[Events]
//Background and Video events
0,0,"bg.png",0,0
//Break Periods
//Storyboard Layer 0 (Background)
//Storyboard Layer 1 (Fail)
//Storyboard Layer 2 (Pass)
//Storyboard Layer 3 (Foreground)
//Storyboard Layer 4 (Overlay)
//Storyboard Sound Samples

[TimingPoints]
1033,255.31914893617,4,2,0,50,1,0
8309,-80,4,2,0,70,0,0
9203,-125,4,2,0,50,0,0
16479,-86.9565217391304,4,2,0,70,0,0
16671,-86.9565217391304,4,2,0,5,0,0
16735,-80,4,2,0,70,0,0
16926,-80,4,2,0,5,0,0
16990,-95.2380952380952,4,2,0,70,0,0
17373,-100,4,2,0,70,0,0
20437,-83.3333333333333,4,2,0,80,0,0
21458,-100,4,2,0,70,0,0
23501,-83.3333333333333,4,2,0,70,0,0
25288,-333.333333333333,4,2,0,50,0,0
25543,-83.3333333333333,4,2,0,80,0,0
41628,-133.333333333333,4,2,0,80,0,0
41884,-597.907320658366,4,2,0,50,0,0
44437,-597.907320658366,4,2,0,5,0,0


[Colours]
Combo1 : 97,39,245
Combo2 : 120,118,152
Combo3 : 39,108,245
Combo4 : 194,191,199

[HitObjects]
389,171,8309,6,1,B|374:154|374:154|275:176|275:176|272:181|272:181|193:201|193:201|171:167,2,252.499999999999,4|4|5,0:0|0:0|0:0,0:0:0:0:
0,95,9203,5,0,3:0:0:0:
0,95,9458,2,0,L|94:111,1,80.8,10|0,0:2|0:0,0:0:0:0:
182,0,9713,2,0,P|159:32|159:72,1,80.8,2|0,3:2|0:0,0:0:0:0:
205,205,9969,1,10,0:2:0:0:
243,61,10096,1,2,0:0:0:0:
117,186,10224,6,0,L|37:200,1,80.8,2|0,3:2|0:0,0:0:0:0:
288,217,10479,2,0,P|287:177|264:144,1,80.8,10|0,0:0|0:0,0:0:0:0:
103,282,10735,2,0,L|182:296,1,80.8,2|0,3:2|0:0,0:0:0:0:
356,273,10990,1,10,0:2:0:0:
205,205,11118,1,2,0:0:0:0:
360,171,11245,5,2,3:2:0:0:
309,350,11373,1,0,1:0:0:0:
363,157,11501,2,0,L|442:171,1,80.8,10|0,0:0|0:0,0:0:0:0:
205,205,11756,2,1,B|193:165|193:165|214:126,1,80.8,2|0,3:2|0:0,0:0:0:0:
433,248,12011,2,1,B|445:288|445:288|424:327,1,80.8,10|2,0:0|0:0,0:0:0:0:
232,302,12267,6,0,L|153:288,1,80.8,0|0,1:0|0:0,0:0:0:0:
283,176,12522,1,8,0:0:0:0:
310,346,12650,2,1,B|329:312|329:312|317:272,1,80.8,0|0,1:0|3:0,0:0:0:0:
202,142,12905,5,0,1:0:0:0:
232,302,13032,1,8,1:2:0:0:
367,200,13160,1,0,3:0:0:0:
199,57,13288,6,0,P|150:62|124:171,1,161.6,0|10,3:0|0:0,0:0:0:0:
300,131,13671,1,0,0:0:0:0:
216,221,13798,2,0,L|202:142,1,80.8,2|0,3:2|0:0,0:0:0:0:
332,35,14054,1,10,0:0:0:0:
314,227,14181,1,2,0:0:0:0:
419,29,14309,6,1,B|421:70|421:70|394:99,1,80.8,2|0,3:2|0:0,0:0:0:0:
132,166,14564,2,1,B|161:139|161:139|202:141,1,80.8,10|0,0:0|0:0,0:0:0:0:
470,235,14820,2,1,B|400:224|400:224|379:237|379:237|296:224,1,161.6,2|10,3:2|0:0,0:0:0:0:
394,99,15203,1,2,0:0:0:0:
423,310,15330,6,1,B|435:350|435:350|416:384,1,80.8,2|0,3:2|0:0,0:0:0:0:
240,268,15586,2,1,B|221:234|221:234|233:194,1,80.8,10|0,0:0|0:0,0:0:0:0:
423,310,15841,2,0,L|502:324,1,80.8,2|0,3:2|0:0,0:0:0:0:
233,193,16096,2,0,L|154:207,1,80.8,10|2,0:0|0:0,0:0:0:0:
417,168,16352,1,2,3:1:0:0:
273,384,16479,6,0,B|256:341|214:330|214:330|184:364|133:365,1,174.225003323078,4|0,2:0|0:0,0:0:0:0:
103,149,16735,6,0,P|76:233|147:286,1,189.375,4|0,0:0|0:0,0:0:0:0:
355,221,16990,6,0,B|222:255|222:255|255:257|289:283,1,212.099993527222,4|0,0:0|0:0,0:0:0:0:
75,68,17373,6,0,B|179:46|155:138|259:117,1,202,0|0,1:0|0:0,0:0:0:0:
103,149,17756,1,8,0:0:0:0:
400,20,18139,1,2,1:0:0:0:
357,188,18267,1,0,3:0:0:0:
394,4,18394,6,0,B|261:38|261:38|294:40|328:66,1,202,0|0,1:0|0:0,0:0:0:0:
419,244,18777,2,1,B|444:199|444:199|428:147,1,101,8|0,0:0|0:0,0:0:0:0:
3,133,19160,2,0,L|129:153,1,101,2|0,1:0|0:0,0:0:0:0:
263,181,19415,6,0,B|155:159|180:254|72:232,1,202,0|0,1:0|0:0,0:0:0:0:
234,264,19798,1,8,0:0:0:0:
393,24,20181,5,0,3:0:0:0:
398,38,20245,1,0,3:0:0:0:
403,52,20309,1,0,3:0:0:0:
102,148,20437,6,1,B|84:88|84:88|113:37,1,121.19999630127,4|0,3:2|0:0,0:0:0:0:
403,52,20692,6,1,B|432:103|432:103|414:163,1,121.19999630127,4|0,3:2|0:0,0:0:0:0:
120,242,20947,6,0,L|-32:257,1,121.19999630127,4|0,3:2|0:0,0:0:0:0:
464,242,21203,5,4,3:2:0:0:
338,115,21330,1,0,3:0:0:0:
353,343,21458,6,0,L|454:333,1,101,0|0,1:2|0:0,0:0:0:0:
414,162,21713,1,2,1:0:0:0:
235,292,21841,2,1,B|201:297|181:332|181:332|169:279|223:259|182:197,1,201.999999999999,0|0,3:0|0:0,0:0:0:0:
253,370,22224,2,0,L|354:360,1,101,2|0,1:0|0:0,0:0:0:0:
127,152,22479,6,1,B|101:196|101:196|117:247,1,101,0|0,1:0|0:0,0:0:0:0:
253,370,22735,1,2,1:0:0:0:
205,117,22862,2,0,B|152:63|152:63|8:104,1,202,0|0,3:0|0:0,0:0:0:0:
116,244,23245,5,2,1:0:0:0:
241,42,23373,1,0,3:0:0:0:
167,307,23501,6,1,B|107:325|107:325|56:296,1,121.19999630127,4|0,3:2|0:0,0:0:0:0:
130,31,23756,6,1,B|190:13|190:13|241:42,1,121.19999630127,4|0,3:2|0:0,0:0:0:0:
56,296,24011,6,0,L|78:169,1,121.19999630127,4|0,3:2|0:0,0:0:0:0:
316,17,24267,5,4,3:2:0:0:
320,61,24330,1,0,3:0:0:0:
299,101,24394,1,0,3:0:0:0:
260,123,24458,1,0,3:0:0:0:
215,119,24522,1,0,3:0:0:0:
42,355,25288,6,0,L|33:395,1,30.2999990753174,2|2,1:0|1:0,0:0:0:0:
76,271,25543,22,1,B|62:221|62:221|59:216|59:216|40:151|40:151|57:189|94:196,1,181.799994451904,4|0,3:2|0:0,0:0:0:0:
114,123,25798,2,1,B|173:105|173:105|231:137,1,121.199999999996,8|0,0:0|0:0,0:0:0:0:
42,355,26054,1,0,3:0:0:0:
42,355,26181,1,0,3:0:0:0:
225,133,26309,1,8,0:0:0:0:
12,228,26437,1,2,0:0:0:0:
277,228,26564,6,0,L|434:200,1,121.19999630127,0|0,3:0|0:0,0:0:0:0:
48,14,26820,2,1,B|19:65|19:65|37:125,1,121.199999999996,8|0,0:0|0:0,0:0:0:0:
169,314,27075,1,0,3:0:0:0:
169,314,27203,1,0,3:0:0:0:
293,64,27330,1,8,0:0:0:0:
37,125,27458,1,2,0:0:0:0:
370,112,27586,6,1,B|387:52|387:52|359:0,1,121.199999999996,0|0,3:0|3:0,0:0:0:0:
147,194,27841,2,0,L|169:320,1,121.19999630127,8|0,0:0|0:0,0:0:0:0:
212,34,28096,1,0,3:0:0:0:
212,34,28224,1,0,3:0:0:0:
321,188,28352,2,1,B|381:205|381:205|433:177,1,121.199999999996,8|0,0:0|0:0,0:0:0:0:
126,67,28607,5,0,3:0:0:0:
370,112,28735,1,0,3:0:0:0:
370,112,28798,1,0,3:0:0:0:
370,112,28862,1,12,0:0:0:0:
116,297,28990,1,0,3:0:0:0:
212,34,29118,5,12,0:0:0:0:
267,358,29245,1,0,3:0:0:0:
38,96,29373,5,12,0:0:0:0:
336,0,29501,1,0,3:0:0:0:
123,373,29628,6,0,P|46:321|88:226,1,181.799994451904,0|0,3:2|0:0,0:0:0:0:
127,201,29884,2,0,L|285:229,1,121.19999630127,8|0,0:0|0:0,0:0:0:0:
448,384,30139,2,1,B|476:332|476:332|459:272,1,121.199999999996,0|0,3:0|3:0,0:0:0:0:
302,112,30394,1,8,0:0:0:0:
340,310,30522,1,2,0:0:0:0:
431,65,30650,5,0,3:0:0:0:
431,65,30777,1,0,3:0:0:0:
179,170,30905,2,1,B|162:230|162:230|190:282,1,121.199999999996,8|0,0:0|0:0,0:0:0:0:
415,184,31160,1,0,3:0:0:0:
205,73,31288,1,2,0:0:0:0:
339,293,31415,2,0,L|497:265,1,121.19999630127,8|0,0:0|0:0,0:0:0:0:
287,22,31671,5,8,0:0:0:0:
253,352,31798,1,8,0:0:0:0:
0,139,32437,5,8,0:0:0:0:
376,91,32564,1,8,0:0:0:0:
252,51,33203,5,8,0:0:0:0:
254,363,33330,1,8,0:0:0:0:
118,49,33458,1,0,3:0:0:0:
99,72,33521,1,0,3:0:0:0:
92,101,33585,1,0,3:0:0:0:
97,131,33649,1,0,3:0:0:0:
115,155,33713,5,12,0:2:0:0:
425,86,33841,1,0,3:0:0:0:
178,101,33969,5,8,0:0:0:0:
467,162,34096,1,0,3:0:0:0:
175,207,34224,5,8,0:0:0:0:
512,88,34352,1,0,3:0:0:0:
118,49,34479,5,8,0:0:0:0:
471,12,34607,1,0,3:0:0:0:
182,331,34735,5,8,0:0:0:0:
425,86,34862,1,0,3:0:0:0:
304,379,34990,5,8,0:0:0:0:
304,34,35118,1,0,3:0:0:0:
425,329,35245,5,8,0:0:0:0:
182,86,35373,1,0,3:0:0:0:
476,206,35501,5,8,0:0:0:0:
131,206,35628,1,0,3:0:0:0:
425,86,35756,5,8,0:0:0:0:
95,121,35884,1,0,3:0:0:0:
342,305,36011,5,8,0:0:0:0:
106,33,36139,1,0,3:0:0:0:
97,288,36267,5,8,0:0:0:0:
187,0,36394,1,0,3:0:0:0:
154,352,36522,5,8,0:0:0:0:
24,67,36650,1,0,3:0:0:0:
369,280,36777,5,0,3:0:0:0:
369,280,36841,1,0,3:0:0:0:
369,280,36905,2,0,L|280:269,1,60.5999981506348,0|0,3:0|3:0,3:0:0:0:
115,206,37032,5,12,0:0:0:0:
463,136,37159,1,0,3:0:0:0:
95,121,37288,5,12,0:0:0:0:
480,219,37415,1,0,3:0:0:0:
34,179,37542,5,12,0:0:0:0:
446,52,37670,1,0,3:0:0:0:
238,293,37798,5,8,0:0:0:0:
172,0,37926,1,0,3:0:0:0:
173,349,38054,5,8,0:0:0:0:
231,57,38181,1,0,3:0:0:0:
255,374,38309,5,8,0:0:0:0:
150,80,38437,1,0,3:0:0:0:
173,349,38564,5,8,0:0:0:0:
231,57,38692,1,0,3:0:0:0:
398,345,38820,5,8,0:0:0:0:
66,251,38947,1,0,3:0:0:0:
398,345,39075,5,8,0:0:0:0:
66,251,39202,1,0,3:0:0:0:
417,232,39330,5,8,0:0:0:0:
87,334,39457,1,0,3:0:0:0:
417,232,39585,5,8,0:0:0:0:
87,334,39712,1,0,3:0:0:0:
477,301,39841,5,8,0:0:0:0:
105,176,39969,1,8,0:0:0:0:
66,251,40607,5,8,0:0:0:0:
458,152,40735,1,8,0:0:0:0:
316,19,41373,5,8,0:0:0:0:
241,339,41501,1,8,0:0:0:0:
201,37,41628,2,0,L|211:128,1,75.7500028896333,8|0,1:0|0:0,0:0:0:0:
109,267,41884,6,2,B|75:225|30:236|30:236|49:157|133:140|133:140|152:193|216:193,1,337.845002094262,2|0,3:1|0:0,0:1:0:0:
`);

console.log(beatmap.getArtist());
console.log(beatmap.getTitle());
console.log(beatmap.getVersion());

const ruleset = Ruleset.fromId(0);
const diffCalculator =
  DifficultyCalculatorFactory.create<OsuDifficultyCalculator>(ruleset, beatmap);
const calculator =
  PerformanceCalculatorFactory.create<OsuPerformanceCalculator>(ruleset);

const mods = ModsCollection.create();
const modHd = Mod.create("HD");
const modDt = Mod.create("DT");
const modCl = Mod.create("CL");
mods.add(modHd);
mods.add(modDt);
mods.add(modCl);

const attrs = diffCalculator.calculateWithModsTimed(mods);

console.log("Attributes:");

for (const attr of attrs) {
  console.log(attr.time, attr.attributes.hitCircleCount);
}

const attributes = diffCalculator.calculateWithMods(mods);

const scoreInfo: ScoreInfoInput = {
  ruleset: ruleset,
  beatmap: beatmap,
  mods: mods,
  maxCombo: 238,
  countGreat: 178,
  countSliderTailHit: !mods.has(modCl) ? 55 : 0,
  accuracy: 1,
};

const result = calculator.calculate(scoreInfo, attributes);
console.log("Total PP:", result.total);
